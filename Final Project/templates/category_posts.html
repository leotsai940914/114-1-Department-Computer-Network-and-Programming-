{% extends "base.html" %}

{% block content %}

<div class="container category-section">

    <h2 class="section-title">{{ category_name }}</h2>

    {% if posts %}
        {% for post in posts %}
        <div class="post-card">
            
            <h3 class="post-title">
                <a href="{{ url_for('post_routes.post_detail', post_id=post['id']) }}">
                    {{ post['title'] }}
                </a>
            </h3>

            <div class="meta-row">
                <span class="meta-chip">{{ post['category_name'] }}</span>
                <span>{{ post['created_at'] }}</span>
                {% if post['author_name'] %}
                <a class="meta-chip" href="{{ url_for('post_routes.author_page', username=post['author_name']) }}">作者：{{ post['author_name'] }}</a>
                {% endif %}
            </div>

            <p class="post-excerpt">
                {{ post['content'] | striptags | truncate(80, True, '…') }}
            </p>
            <a class="inline-more" href="{{ url_for('post_routes.post_detail', post_id=post['id']) }}">閱讀更多 →</a>

        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>這個分類目前沒有文章，快來寫下第一篇吧。</p>
            {% if session.get('role') == 'admin' %}
                <a class="hero-btn" href="{{ url_for('post_routes.new_post') }}">撰寫第一篇</a>
            {% else %}
                <a class="hero-btn" href="{{ url_for('auth_routes.login') }}">登入後新增文章</a>
            {% endif %}
        </div>
    {% endif %}

</div>

{% endblock %}
