{% extends "base.html" %}
{% block content %}

<div class="container">

    <h2 class="section-title">新增文章</h2>

    <!-- POST form -->
    <form id="postForm"
          class="newpost-form"
          method="POST"
          action="{{ url_for('post_routes.new_post') }}">

        {% if error %}
        <p style="color:#b00020; margin-bottom:1rem;">{{ error }}</p>
        {% endif %}

        <!-- 標題 -->
        <label class="form-label">文章標題</label>
        <input type="text" class="form-input" name="title"
               placeholder="請輸入文章標題" required>

        <!-- 內容（Quill 替換 textarea） -->
        <label class="form-label">文章內容</label>

        <!-- Quill 編輯器顯示的區域 -->
        <div id="quillEditor"
             style="height: 300px; background: #fff;"></div>

        <!-- 隱藏欄位：送出前填入 HTML -->
        <input type="hidden" name="content" id="contentInput">

        <!-- 分類 -->
        <label class="form-label">文章分類</label>
        <select class="form-input" name="category_id" required>
            {% for c in categories %}
            <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
        </select>

        <!-- 封面圖片 -->
        <label class="form-label">封面圖片 URL（選填）</label>
        <input type="text" class="form-input" name="cover_image"
               placeholder="https://example.com/poster.jpg">

        <!-- 按鈕 -->
        <button class="submit-btn" type="submit">發布文章</button>

    </form>

</div>

<!-- ===============================
     Quill.js CDN
================================= -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<!-- ===============================
     初始化 Quill + 表單提交處理
================================= -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    // 建立 Quill 編輯器
    var quill = new Quill("#quillEditor", {
        theme: "snow",
        placeholder: "請輸入文章內容…",
        modules: {
            toolbar: [
                [{ header: [1, 2, 3, false] }],
                ["bold", "italic", "underline"],
                ["blockquote", "code-block"],
                [{ list: "ordered" }, { list: "bullet" }],
                ["link", "image"]
            ]
        }
    });

    // 表單送出 → 將 HTML 塞入 hidden input
    document.getElementById("postForm").onsubmit = function () {
        var html = quill.root.innerHTML.trim();

        // 防止空文章
        if (html === "<p><br></p>" || html.length < 5) {
            alert("文章內容不得為空");
            return false;
        }

        document.getElementById("contentInput").value = html;
    };

});
</script>

{% endblock %}